<h1>Listing event_instances</h1>

<% form_for @search do |f| %>
<p>
  <%= f.label :start_gte, "Start Time Between" %>
  <%= f.text_field :start_gte, :size =>15  %> and <%= f.text_field :start_lte, :size =>15  %>
</p>

<p>
  <%= f.label :age_limit_id_equals, "Age Category"%>
  <%= f.collection_select :age_limit_id_equals, AgeLimit.all, :id, :name, :include_blank => true %>
</p>

<p>
  <%
    if @category_id.nil?
      concat f.label :category_id_equals, "Category"
      concat render :partial => "shared/dropdown",
        :locals => {
          :name => "search[category_id_equals]",
          :collection => Category.all
        }
      concat observe_field "search_category_id_equals", :url => { :action => :genre_dropdown },
        :update => :genre_dropdown,
        :with => 'category_id'
    else
      concat "Category is :" + Category.find(@category_id).name
      concat hidden_field_tag :category_id, @category_id
    end
  %>
  <input type="hidden" name="category_id" value="<%= @category_id %>" />
</p>

<p>
  <%= f.label :genre_id_equals, "Genre"%>
  <div id="genre_dropdown">
    <%=render :partial => "shared/dropdown", 
        :locals => {:name => "search[genre_id_equals]", :collection => @genres_collection,
          :include_blank => true, :selected => @genre_id } %>
  </div>
</p>

<p>
  <%= f.label :notes_like, "Event Name" %> <br />
  <%= f.text_field :notes_like %>
</p>

  <%= f.submit "Search" %>
<%end%>

<table>
  <tr>
    <th>Start</th>
    <th>End</th>
    <th>Notes</th>
    <th>Ticketprice</th>
    <th>Doorprice</th>
    <th>Age Limit</th>
    <th>Genre</th>
  </tr>

<% @event_instances.each do |event_instance| %>
  <tr>
    <td><%=h event_instance.start %></td>
    <td><%=h event_instance.end %></td>
    <td><%=h event_instance.notes %></td>
    <td><%=h_euro_b(event_instance.ticketPrice) %></td>
    <td><%=h_euro_b(event_instance.doorPrice) %></td>
    <td><%=h AgeLimit.find(event_instance.age_limit_id).name %></td>
    <td><%=h Genre.find(event_instance.genre_id).name %></td>
    <td><%= link_to 'Show', event_instance %></td>
    <td><%= link_to 'Edit', edit_event_instance_path(event_instance) %></td>
    <td><%= link_to 'Destroy', event_instance, :confirm => 'Are you sure?', :method => :delete %></td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New event_instance', new_event_instance_path %>